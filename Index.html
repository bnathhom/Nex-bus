<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BN POS System - SaaS Edition</title>
    
    <!-- 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á React ‡πÅ‡∏•‡∏∞ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Babel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡πÇ‡∏Ñ‡πâ‡∏î React -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏ß‡∏¢‡πÜ -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #F8FAFC; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Animation Classes */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICON COMPONENTS (‡∏à‡∏≥‡∏•‡∏≠‡∏á Lucide React) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        
        const Icons = {
            Store: (p) => <IconBase {...p}><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></IconBase>,
            Coffee: (p) => <IconBase {...p}><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></IconBase>,
            Utensils: (p) => <IconBase {...p}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>,
            Zap: (p) => <IconBase {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>,
            Package: (p) => <IconBase {...p}><path d="m16.5 9.4-9-5.19"/><path d="m21 16-9 5.19-9-5.19"/><path d="m3.29 7 9-5.19 9 5.19"/><line x1="12" y1="2" x2="12" y2="22"/><path d="m12 22 9-5.19V7l-9 5.19-9-5.19v9.81Z"/></IconBase>,
            ShoppingCart: (p) => <IconBase {...p}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></IconBase>,
            Plus: (p) => <IconBase {...p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></IconBase>,
            Minus: (p) => <IconBase {...p}><line x1="5" y1="12" x2="19" y2="12"/></IconBase>,
            Trash2: (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>,
            Search: (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconBase>,
            X: (p) => <IconBase {...p}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>,
            Receipt: (p) => <IconBase {...p}><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 17V7"/></IconBase>,
            CreditCard: (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></IconBase>,
            Banknote: (p) => <IconBase {...p}><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></IconBase>,
            QrCode: (p) => <IconBase {...p}><rect width="5" height="5" x="3" y="3" rx="1"/><rect width="5" height="5" x="16" y="3" rx="1"/><rect width="5" height="5" x="3" y="16" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M12 7v3a2 2 0 0 1-2 2H7"/><path d="M3 12h.01"/><path d="M12 3h.01"/><path d="M12 16v.01"/><path d="M16 12h1"/><path d="M21 12v.01"/><path d="M12 21v-1"/></IconBase>,
            Home: (p) => <IconBase {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>,
            History: (p) => <IconBase {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></IconBase>,
            LayoutDashboard: (p) => <IconBase {...p}><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></IconBase>,
            Settings: (p) => <IconBase {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></IconBase>,
            LogOut: (p) => <IconBase {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></IconBase>,
            Clock: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>,
            User: (p) => <IconBase {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            Lock: (p) => <IconBase {...p}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>,
            CheckCircle: (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>,
            Printer: (p) => <IconBase {...p}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconBase>,
            Save: (p) => <IconBase {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></IconBase>,
            Edit3: (p) => <IconBase {...p}><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></IconBase>,
            TrendingUp: (p) => <IconBase {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></IconBase>,
            AlertCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>,
            Download: (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>,
            PlusCircle: (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></IconBase>,
            UploadCloud: (p) => <IconBase {...p}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></IconBase>,
            ShieldCheck: (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></IconBase>,
            Calendar: (p) => <IconBase {...p}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></IconBase>,
            UserCheck: (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></IconBase>,
            UserX: (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="17" y1="8" x2="22" y2="13"/><line x1="22" y1="8" x2="17" y2="13"/></IconBase>,
            MapPin: (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>,
            BadgePercent: (p) => <IconBase {...p}><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.78 4.78 4 4 0 0 1-6.74 0 4 4 0 0 1-4.78-4.78 4 4 0 0 1 0-6.74Z"/><path d="m15 9-6 6"/><path d="M9 9h.01"/><path d="M15 15h.01"/></IconBase>,
            Scan: (p) => <IconBase {...p}><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/></IconBase>,
            ArrowUpRight: (p) => <IconBase {...p}><path d="M7 7h10v10"/><path d="M7 17 17 7"/></IconBase>
        };

        // --- CONSTANTS ---
        const MASTER_ADMIN = {
            email: 'bnathhomsombath@gmail.com',
            password: 'Asdf123#' 
        };

        // --- HELPER ---
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB' }).format(amount);
        };

        const INITIAL_PRODUCTS = [
            { id: 101, barcode: '885101', name: 'Sig. Americano', price: 65, cost: 25, category: 'Coffee', stock: 50, image: '‚òï', color: 'from-amber-900 to-amber-700 text-amber-50' },
            { id: 102, barcode: '885102', name: 'Caramel Macchiato', price: 85, cost: 35, category: 'Coffee', stock: 40, image: 'ü•õ', color: 'from-amber-800 to-amber-600 text-amber-50' },
            { id: 103, barcode: '885103', name: 'Premium Matcha', price: 90, cost: 40, category: 'Tea', stock: 25, image: 'üçµ', color: 'from-green-800 to-green-600 text-green-50' },
            { id: 201, barcode: '885201', name: 'Butter Croissant', price: 65, cost: 30, category: 'Bakery', stock: 12, image: 'ü•ê', color: 'from-yellow-600 to-yellow-400 text-yellow-50' },
            { id: 301, barcode: '885301', name: 'Mineral Water', price: 15, cost: 5, category: 'Mart', stock: 100, image: 'üíß', color: 'from-blue-500 to-blue-300 text-blue-50' },
        ];

        const CATEGORIES = [
            { id: 'All', name: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', icon: Icons.Store },
            { id: 'Coffee', name: '‡∏Å‡∏≤‡πÅ‡∏ü', icon: Icons.Coffee },
            { id: 'Tea', name: '‡∏ä‡∏≤', icon: Icons.Zap },
            { id: 'Bakery', name: '‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà', icon: Icons.Utensils },
            { id: 'Mart', name: '‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≤‡∏£‡πå‡∏ó', icon: Icons.Package },
        ];

        // --- COMPONENTS ---

        const ImageUploader = ({ label, currentImage, onImageChange }) => {
            const fileInputRef = useRef(null);
            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 500000) { alert("‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (Max 500KB)"); return; }
                    const reader = new FileReader();
                    reader.onloadend = () => { onImageChange(reader.result); };
                    reader.readAsDataURL(file);
                }
            };
            return (
                <div className="space-y-2">
                    <label className="block text-sm font-semibold text-slate-600">{label}</label>
                    <div onClick={() => fileInputRef.current.click()} className="relative group cursor-pointer border-2 border-dashed border-slate-300 rounded-2xl p-4 flex flex-col items-center justify-center transition-all hover:border-blue-500 hover:bg-blue-50 h-40 overflow-hidden bg-slate-50">
                        {currentImage ? (
                            <img src={currentImage} alt="Uploaded" className="w-full h-full object-contain z-10" />
                        ) : (
                            <div className="text-center text-slate-400 group-hover:text-blue-500">
                                <Icons.UploadCloud size={32} className="mx-auto mb-2" />
                                <span className="text-xs">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</span>
                            </div>
                        )}
                        <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileChange} />
                    </div>
                </div>
            );
        };

        const ProductCard = ({ product, onAdd, currentStock }) => {
            const isOutOfStock = currentStock <= 0;
            return (
                <div onClick={() => !isOutOfStock && onAdd(product)} className={`relative bg-white rounded-3xl p-4 shadow-sm border border-slate-100 transition-all duration-300 group flex flex-col h-full overflow-hidden ${isOutOfStock ? 'opacity-60 cursor-not-allowed grayscale' : 'hover:shadow-xl hover:border-blue-200 hover:-translate-y-1 cursor-pointer'}`}>
                    {isOutOfStock && <div className="absolute inset-0 z-20 flex items-center justify-center bg-white/60 backdrop-blur-sm"><span className="bg-red-500 text-white text-xs font-bold px-4 py-2 rounded-full shadow-lg">Sold Out</span></div>}
                    <div className={`h-36 rounded-2xl flex items-center justify-center text-6xl mb-4 shadow-inner bg-gradient-to-br ${product.color} relative overflow-hidden group-hover:scale-[1.02] transition-transform duration-500`}>
                        <div className="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div><span className="drop-shadow-lg filter">{product.image}</span>
                    </div>
                    <div className="space-y-1 mt-auto">
                        <h3 className="font-bold text-slate-800 line-clamp-1 text-base">{product.name}</h3>
                        <div className="flex justify-between items-center"><span className="text-[10px] uppercase font-bold tracking-wider text-slate-400 bg-slate-50 px-2 py-1 rounded-lg border border-slate-100">{product.category}</span><span className="text-xs font-semibold text-slate-400">Stock: {currentStock}</span></div>
                        <div className="pt-3 flex justify-between items-center"><span className="text-xl font-black text-slate-800">{formatCurrency(product.price)}</span></div>
                    </div>
                </div>
            );
        };

        const AuthScreen = ({ onLogin }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({ email: '', password: '', shopName: '', confirmPass: '' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                if (isLogin && formData.email === MASTER_ADMIN.email && formData.password === MASTER_ADMIN.password) {
                    onLogin({ role: 'admin', email: MASTER_ADMIN.email, shopName: 'Master Admin Shop', status: 'active', expiryDate: '9999-12-31' });
                    return;
                }
                const usersDb = JSON.parse(localStorage.getItem('bn_pos_users_db') || '[]');
                if (isLogin) {
                    const foundUser = usersDb.find(u => u.email === formData.email && u.password === formData.password);
                    if (foundUser) { onLogin({ ...foundUser, role: 'user' }); } else { setError('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
                } else {
                    if (formData.password !== formData.confirmPass) { setError('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'); return; }
                    if (usersDb.find(u => u.email === formData.email)) { setError('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß'); return; }
                    if (!formData.shopName) { setError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô'); return; }
                    const newUser = { email: formData.email, password: formData.password, shopName: formData.shopName, status: 'pending', expiryDate: null, joinedAt: new Date().toISOString() };
                    usersDb.push(newUser);
                    localStorage.setItem('bn_pos_users_db', JSON.stringify(usersDb));
                    onLogin({ ...newUser, role: 'user' });
                }
            };

            return (
                <div className="fixed inset-0 bg-[#0F172A] flex items-center justify-center z-50 overflow-hidden font-sans">
                    <div className="bg-white/10 backdrop-blur-xl border border-white/20 p-8 rounded-3xl shadow-2xl w-full max-w-md relative z-10 text-white">
                        <div className="text-center mb-8"><h2 className="text-3xl font-bold tracking-tight">BN POS <span className="text-blue-400">SaaS</span></h2><p className="text-slate-300 text-sm mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</p></div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {!isLogin && <input type="text" required className="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-white" value={formData.shopName} onChange={e => setFormData({...formData, shopName: e.target.value})} placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" />}
                            <input type="email" required className="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-white" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} placeholder="email@example.com" />
                            <input type="password" required className="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-white" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                            {!isLogin && <input type="password" required className="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-white" value={formData.confirmPass} onChange={e => setFormData({...formData, confirmPass: e.target.value})} placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" />}
                            {error && <div className="p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-200 text-sm flex items-center gap-2"><Icons.AlertCircle size={16}/> {error}</div>}
                            <button type="submit" className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:shadow-lg transition-all mt-4">{isLogin ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'}</button>
                        </form>
                        <div className="mt-6 text-center"><button onClick={() => {setIsLogin(!isLogin); setError(''); setFormData({email:'', password:'', shopName:'', confirmPass:''})}} className="text-slate-400 hover:text-white text-sm transition-colors">{isLogin ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' : '‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}</button></div>
                    </div>
                </div>
            );
        };

        const SubscriptionWall = ({ user, onLogout }) => {
            const isPending = user.status === 'pending';
            return (
                <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 font-sans">
                    <div className="max-w-md w-full bg-white rounded-3xl shadow-xl p-8 text-center border border-slate-100">
                        <div className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 ${isPending ? 'bg-orange-100 text-orange-500' : 'bg-red-100 text-red-500'}`}>{isPending ? <Icons.Clock size={40} /> : <Icons.ShieldCheck size={40} />}</div>
                        <h2 className="text-2xl font-black text-slate-800 mb-2">{isPending ? '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏'}</h2>
                        <p className="text-slate-500 mb-8">{isPending ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì' : '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏'}</p>
                        <div className="bg-slate-50 p-4 rounded-xl mb-8 border border-slate-100 text-left"><p className="text-slate-700 font-medium">Line ID: @bnpos_support</p></div>
                        <button onClick={onLogout} className="w-full py-3 bg-slate-200 text-slate-600 font-bold rounded-xl hover:bg-slate-300 transition-colors">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                </div>
            );
        };

        const AdminPanel = () => {
            const [users, setUsers] = useState(() => JSON.parse(localStorage.getItem('bn_pos_users_db') || '[]'));
            const updateUserStatus = (email, status, daysToAdd = 0) => {
                const updatedUsers = users.map(user => {
                    if (user.email === email) {
                        let newExpiry = user.expiryDate ? new Date(user.expiryDate) : new Date();
                        if (daysToAdd > 0) { if (!user.expiryDate || new Date(user.expiryDate) < new Date()) newExpiry = new Date(); newExpiry.setDate(newExpiry.getDate() + daysToAdd); }
                        return { ...user, status: status, expiryDate: status === 'active' ? newExpiry.toISOString() : user.expiryDate };
                    }
                    return user;
                });
                setUsers(updatedUsers);
                localStorage.setItem('bn_pos_users_db', JSON.stringify(updatedUsers));
            };
            const deleteUser = (email) => { if(confirm('‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ?')) { const updated = users.filter(u => u.email !== email); setUsers(updated); localStorage.setItem('bn_pos_users_db', JSON.stringify(updated)); }};

            return (
                <div className="p-8 h-full flex flex-col bg-slate-50/50 overflow-y-auto">
                    <h2 className="text-4xl font-black text-slate-800 mb-8 flex items-center gap-2"><Icons.ShieldCheck className="text-blue-600"/> Admin Control</h2>
                    <div className="bg-white rounded-[2rem] shadow-sm border border-slate-200 overflow-hidden">
                        <table className="w-full text-left">
                            <thead className="bg-slate-50 text-slate-500 text-sm font-bold"><tr><th className="p-6">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th><th className="p-6">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th className="p-6">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th><th className="p-6 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                            <tbody className="divide-y divide-slate-100">
                                {users.map(u => (
                                    <tr key={u.email} className="hover:bg-slate-50">
                                        <td className="p-6"><b>{u.shopName}</b><br/><span className="text-xs text-slate-500">{u.email}</span></td>
                                        <td className="p-6"><span className={`px-2 py-1 rounded text-xs font-bold ${u.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}`}>{u.status}</span></td>
                                        <td className="p-6 text-sm">{u.expiryDate ? new Date(u.expiryDate).toLocaleDateString() : '-'}</td>
                                        <td className="p-6 flex justify-center gap-2">
                                            <button onClick={()=>updateUserStatus(u.email,'active',30)} className="p-2 bg-blue-100 text-blue-600 rounded"><Icons.Calendar size={16}/></button>
                                            <button onClick={()=>updateUserStatus(u.email,'suspended')} className="p-2 bg-orange-100 text-orange-600 rounded"><Icons.UserX size={16}/></button>
                                            <button onClick={()=>deleteUser(u.email)} className="p-2 bg-red-100 text-red-600 rounded"><Icons.Trash2 size={16}/></button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, onLogout, shopLogo, isAdmin }) => (
            <div className="w-24 bg-white/80 backdrop-blur-xl border-r border-slate-200 flex flex-col items-center py-8 gap-6 h-full shrink-0">
                <div className="w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg overflow-hidden bg-white border border-slate-100">
                    {shopLogo ? <img src={shopLogo} alt="Logo" className="w-full h-full object-cover" /> : <Icons.Store className="text-blue-600" size={28} />}
                </div>
                <nav className="flex-1 flex flex-col gap-4 w-full px-3 mt-4">
                    {[{ id: 'pos', icon: Icons.Home, label: '‡∏Ç‡∏≤‡∏¢' }, { id: 'orders', icon: Icons.History, label: '‡∏ö‡∏¥‡∏•' }, { id: 'inventory', icon: Icons.Package, label: '‡∏™‡∏ï‡πá‡∏≠‡∏Å' }, { id: 'dashboard', icon: Icons.LayoutDashboard, label: '‡∏™‡∏£‡∏∏‡∏õ' }, { id: 'settings', icon: Icons.Settings, label: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤' }]
                    .concat(isAdmin ? [{ id: 'admin', icon: Icons.ShieldCheck, label: 'Admin' }] : [])
                    .map((item) => (
                        <button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center p-3 rounded-2xl transition-all duration-300 group relative ${activeTab === item.id ? 'bg-blue-600 text-white shadow-xl translate-y-[-2px]' : 'text-slate-400 hover:bg-slate-100'}`}>
                            {item.icon({ size: 24, strokeWidth: activeTab === item.id ? 2.5 : 2 })}
                            <span className="text-[10px] mt-1 font-medium">{item.label}</span>
                        </button>
                    ))}
                </nav>
                <button onClick={onLogout} className="p-4 text-slate-400 hover:text-red-500 rounded-2xl"><Icons.LogOut size={24} /></button>
            </div>
        );

        // --- MAIN APP ---
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('pos');
            
            // Data
            const [products, setProducts] = useState(() => JSON.parse(localStorage.getItem(`bn_pos_${currentUser?.email}_products`) || JSON.stringify(INITIAL_PRODUCTS)));
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem(`bn_pos_${currentUser?.email}_history`) || '[]'));
            const [settings, setSettings] = useState(() => JSON.parse(localStorage.getItem(`bn_pos_${currentUser?.email}_settings`) || JSON.stringify({ shopName: currentUser?.shopName || 'My Shop', logo: '' })));

            useEffect(() => { if(currentUser?.email) localStorage.setItem(`bn_pos_${currentUser.email}_products`, JSON.stringify(products)); }, [products, currentUser]);
            useEffect(() => { if(currentUser?.email) localStorage.setItem(`bn_pos_${currentUser.email}_history`, JSON.stringify(history)); }, [history, currentUser]);
            useEffect(() => { if(currentUser?.email) localStorage.setItem(`bn_pos_${currentUser.email}_settings`, JSON.stringify(settings)); }, [settings, currentUser]);

            const [cart, setCart] = useState([]);
            const [showPayment, setShowPayment] = useState(false);
            const [lastOrder, setLastOrder] = useState(null);

            const addToCart = (p) => setCart(prev => { const ex = prev.find(i => i.id === p.id); return ex ? prev.map(i => i.id === p.id ? {...i, qty: i.qty+1} : i) : [...prev, {...p, qty:1}]; });
            const updateQty = (id, d) => setCart(prev => prev.map(i => i.id === id ? {...i, qty: Math.max(1, i.qty+d)} : i));
            const handlePayment = (method) => {
                const total = cart.reduce((a,c)=>a+c.price*c.qty,0);
                const newOrder = { id: `#BN-${Math.floor(Math.random()*10000)}`, total, items: cart, date: new Date().toLocaleString(), method, status: 'completed' };
                setHistory([newOrder, ...history]);
                setProducts(prev => prev.map(p => { const inCart = cart.find(c => c.id === p.id); return inCart ? { ...p, stock: p.stock - inCart.qty } : p; }));
                setLastOrder(newOrder); setCart([]); setShowPayment(false);
            };

            const InventoryView = () => {
                const [isAddMode, setIsAddMode] = useState(false);
                const [newProduct, setNewProduct] = useState({ name: '', price: '', stock: 10, category: 'Mart' });
                return (
                    <div className="p-8 h-full flex flex-col bg-slate-50/50">
                        <div className="flex justify-between mb-8"><h2 className="text-4xl font-black text-slate-800">Inventory</h2><button onClick={()=>setIsAddMode(true)} className="px-6 py-2 bg-blue-600 text-white rounded-xl font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></div>
                        {isAddMode && <div className="mb-6 p-6 bg-white rounded-2xl shadow"><input className="border p-2 rounded mr-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠" value={newProduct.name} onChange={e=>setNewProduct({...newProduct,name:e.target.value})}/><input className="border p-2 rounded mr-2" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" value={newProduct.price} onChange={e=>setNewProduct({...newProduct,price:e.target.value})}/><button onClick={()=>{setProducts([...products, {...newProduct, id:Date.now(), image:'üì¶', color:'from-gray-200 to-gray-100'}]); setIsAddMode(false);}} className="bg-blue-600 text-white px-4 py-2 rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>}
                        <div className="flex-1 overflow-y-auto bg-white rounded-2xl p-4">{products.map(p=><div key={p.id} className="flex justify-between border-b p-3"><span>{p.name}</span><span>{p.stock} ‡∏ä‡∏¥‡πâ‡∏ô</span></div>)}</div>
                    </div>
                );
            };

            const SettingsView = () => (
                <div className="p-8 h-full bg-slate-50/50">
                    <h2 className="text-4xl font-black text-slate-800 mb-8">Settings</h2>
                    <div className="bg-white p-8 rounded-2xl shadow"><label className="block mb-2 font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label><input className="border p-3 rounded-xl w-full mb-4" value={settings.shopName} onChange={e=>setSettings({...settings, shopName:e.target.value})}/><ImageUploader label="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏£‡πâ‡∏≤‡∏ô" currentImage={settings.logo} onImageChange={img=>setSettings({...settings, logo:img})}/></div>
                </div>
            );

            if (!currentUser) return <AuthScreen onLogin={setCurrentUser} />;
            if (currentUser.status !== 'active' && currentUser.role !== 'admin') return <SubscriptionWall user={currentUser} onLogout={() => setCurrentUser(null)} />;

            return (
                <div className="flex h-screen bg-[#F8FAFC] font-sans text-slate-900 overflow-hidden select-none">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} onLogout={() => setCurrentUser(null)} shopLogo={settings.logo} isAdmin={currentUser.role === 'admin'} />
                    <div className="flex-1 flex overflow-hidden relative">
                        {activeTab === 'pos' ? (
                            <>
                                <div className="flex-1 flex flex-col min-w-0 z-10">
                                    <header className="px-8 py-6 flex justify-between items-center"><div><h1 className="text-3xl font-black text-slate-800">{settings.shopName}</h1></div></header>
                                    <div className="px-8 pb-20 overflow-y-auto h-full"><div className="grid grid-cols-4 gap-6">{products.map(p => <ProductCard key={p.id} product={p} onAdd={addToCart} currentStock={p.stock} />)}</div></div>
                                </div>
                                <div className="w-[400px] bg-white border-l border-slate-200 flex flex-col z-20 shadow-xl">
                                    <div className="flex-1 p-6 overflow-y-auto">{cart.map(i => (<div key={i.id} className="flex justify-between mb-4 bg-slate-50 p-3 rounded-xl"><div><div className="font-bold">{i.name}</div><div className="text-sm">x{i.qty}</div></div><div className="font-bold">{i.price * i.qty}</div></div>))}</div>
                                    <div className="p-6 border-t bg-white"><div className="flex justify-between text-2xl font-black mb-4"><span>Total</span><span>{formatCurrency(cart.reduce((a,c)=>a+c.price*c.qty,0))}</span></div><button onClick={() => setShowPayment(true)} disabled={cart.length===0} className="w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700">Charge</button></div>
                                </div>
                            </>
                        ) : activeTab === 'inventory' ? <InventoryView/> : activeTab === 'settings' ? <SettingsView/> : activeTab === 'admin' ? <AdminPanel/> : <div className="p-8"><h2 className="text-4xl font-bold">History</h2><div className="bg-white p-4 rounded-xl mt-4">{history.map(h=><div className="flex justify-between border-b p-3" key={h.id}><span>{h.id}</span><span>{formatCurrency(h.total)}</span></div>)}</div></div>}
                    </div>
                    {showPayment && <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50"><div className="bg-white p-8 rounded-2xl w-96"><h2 className="text-2xl font-bold mb-4">Payment</h2><div className="grid grid-cols-2 gap-4"><button onClick={()=>handlePayment('Cash')} className="p-4 border rounded hover:bg-gray-50">Cash</button><button onClick={()=>handlePayment('QR')} className="p-4 border rounded hover:bg-gray-50">QR</button></div><button onClick={()=>setShowPayment(false)} className="w-full mt-4 py-2 bg-gray-200 rounded">Cancel</button></div></div>}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
